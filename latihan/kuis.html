<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kuis EKG</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- // import font awesome 5 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
</head>

<body class="bg-slate-100 min-h-screen flex flex-col items-center">
    <!-- Tombol Kembali -->
    <div class="w-full max-w-md px-4 py-3">
        <button onclick="history.back();" class="bg-blue-500 text-white px-4 py-2 rounded-lg text-sm flex items-center">
            ‚Üê Kembali
        </button>
    </div>

    <!-- Header -->
    <div id="quiz-header" class="text-center my-4 px-4">
        <h1 class="text-xl font-bold text-blue-600">üìä Latihan Kuis EKG</h1>
        <p class="text-sm text-gray-500">Jawab semua soal dengan fokus</p>
    </div>

    <!-- Progress -->
    <div class="w-full max-w-md px-4 mt-4">
        <div class="flex justify-between text-sm text-gray-600 mb-1">
            <span id="progressText">Soal 1 / 1</span>
        </div>
        <div class="w-full bg-gray-200 rounded-full h-2">
            <div id="progressBar" class="bg-blue-500 h-2 rounded-full" style="width: 0%;"></div>
        </div>
    </div>

    <!-- Container -->
    <div class="w-full max-w-md bg-white rounded-2xl shadow-lg p-4 m-6">
        <div id="quiz-container"></div>

        <!-- Petunjuk -->
        <div class="mt-4" id="petunjukDiv">
            <span id="hintBtn" type="button" isOpen="false" onclick="openHintBox()" class="text-sm text-gray-400">
                Petunjuk <i class="fas fa-chevron-up"></i>
            </span>
            <div id="hintBox" class="hidden mt-2 p-3 border border-2 text-sm"></div>
        </div>

        <!-- Tombol -->
        <div class="flex justify-between mt-6">
            <button id="prevBtn"
                class="bg-gray-300 text-gray-700 px-4 py-2 rounded-lg disabled:opacity-50">Back</button>
            <button id="nextBtn" class="bg-blue-500 text-white px-4 py-2 rounded-lg">Next</button>
        </div>


        <!-- Hasil -->
        <div id="result" class="hidden text-center mt-6">
            <h2 class="text-lg font-bold text-green-600">üéâ Hasil Kuis</h2>
            <p id="scoreText" class="text-gray-700 mt-2"></p>
            <button onclick="restartQuiz()" class="mt-4 bg-blue-500 text-white px-4 py-2 rounded-lg">
                Ulangi Kuis
            </button>
        </div>
    </div>

    <script src="soal_kuis.js"></script>
    <script>
        let currentQuestion = 0;
        let userAnswers = [];

        const quizContainer = document.getElementById("quiz-container");
        const petunjuk = document.getElementById("petunjukDiv");
        const prevBtn = document.getElementById("prevBtn");
        const nextBtn = document.getElementById("nextBtn");
        const progressText = document.getElementById("progressText");
        const progressBar = document.getElementById("progressBar");
        const resultDiv = document.getElementById("result");
        const scoreText = document.getElementById("scoreText");

        // üîπ Acak & ambil 20 soal saja
        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }
        questions = shuffle(questions).slice(0, 20);

        // üîπ Load progress dari localStorage (jika ada)
        const savedProgress = JSON.parse(localStorage.getItem("quizProgress"));
        if (savedProgress) {
            currentQuestion = savedProgress.currentQuestion || 0;
            userAnswers = savedProgress.userAnswers || [];
        }

        function saveProgress() {
            localStorage.setItem("quizProgress", JSON.stringify({
                currentQuestion,
                userAnswers
            }));
        }

        function loadQuestion(index) {
            const q = questions[index];
            quizContainer.innerHTML = `
            <h2 class="text-lg font-semibold mb-4">${index + 1}. ${q.question}</h2>
            <div class="space-y-3">
            ${q.options.map((opt, i) => `
                <div class="option border rounded-lg px-4 py-3 cursor-pointer hover:bg-gray-100" data-index="${i}">
                    <div class="flex flex-col">
                        <span>${String.fromCharCode(65 + i)}. ${opt}</span>
                        <div class="feedback hidden mt-2 text-sm"></div>
                    </div>
                </div>
            `).join("")}
            </div>
        `;

            // Progress
            progressText.textContent = `Soal ${index + 1} / ${questions.length}`;
            progressBar.style.width = `${((index + 1) / questions.length) * 100}%`;

            // Disable prev di soal pertama
            prevBtn.disabled = index === 0;
            nextBtn.textContent = (index === questions.length - 1) ? "Selesai" : "Next";

            // Event klik jawaban
            document.querySelectorAll(".option").forEach(el => {
                el.addEventListener("click", () => checkAnswer(el, index));
            });

            // üîπ Kalau sebelumnya sudah dijawab, tampilkan kembali state jawaban
            if (userAnswers[index] !== undefined) {
                const selected = userAnswers[index];
                const selectedEl = document.querySelector(`.option[data-index="${selected}"]`);
                checkAnswer(selectedEl, index, true);
            }

            // üîπ update tombol petunjuk
            const hintBtn = document.getElementById("hintBtn");
            const hintBox = document.getElementById("hintBox");
            hintBtn.classList.remove("hidden");
            hintBox.classList.add("hidden"); // reset
            document.getElementById("hintBtn").setAttribute('isOpen', '');
            document.getElementById("hintBox").classList.add("hidden");
            document.getElementById("hintBtn").innerHTML = `Petunjuk <i class="fas fa-chevron-up"></i>`;
            hintBox.textContent = q.hints;
        }

        function openHintBox() {
            let status = document.getElementById("hintBtn").getAttribute('isOpen');
            if (!status) {
                document.getElementById("hintBtn").setAttribute('isOpen', 'true');
                document.getElementById("hintBox").classList.remove("hidden");
                document.getElementById("hintBtn").innerHTML = `Petunjuk <i class="fas fa-chevron-down"></i>`;
            } else {
                document.getElementById("hintBtn").setAttribute('isOpen', '');
                document.getElementById("hintBox").classList.add("hidden");
                document.getElementById("hintBtn").innerHTML = `Petunjuk <i class="fas fa-chevron-up"></i>`;
            }
        }

        function checkAnswer(el, index, isRestore = false) {
            if (!el) return;
            const selected = parseInt(el.dataset.index);
            userAnswers[index] = selected;
            const q = questions[index];

            // Lock semua opsi
            document.querySelectorAll(".option").forEach(opt => {
                opt.classList.add("pointer-events-none");
            });

            const feedback = el.querySelector(".feedback");
            feedback.classList.remove("hidden");

            if (selected === q.answer) {
                // ‚úÖ jawaban benar
                el.classList.add("bg-green-100", "border-green-500");
                feedback.innerHTML = `<span class="text-green-600 font-semibold">${q.explanations[selected]}</span>`;
            } else {
                // ‚ùå jawaban salah
                el.classList.add("bg-red-100", "border-red-500");
                feedback.innerHTML = `<span class="text-red-600 font-semibold">${q.explanations[selected]}</span>`;

                // tampilkan jawaban benar
                const correctOpt = document.querySelector(`.option[data-index="${q.answer}"]`);
                const correctFeedback = correctOpt.querySelector(".feedback");
                correctOpt.classList.add("bg-green-100", "border-green-500");
                correctFeedback.classList.remove("hidden");
                correctFeedback.innerHTML = `<span class="text-green-600 font-semibold">${q.explanations[q.answer]}</span>`;
            }

            // üîπ Simpan progres setelah menjawab
            if (!isRestore) saveProgress();
        }

        function finishQuiz() {
            let score = 0;
            questions.forEach((q, i) => {
                if (userAnswers[i] === q.answer) score++;
            });

            resultDiv.classList.remove("hidden");
            quizContainer.classList.add("hidden");
            petunjuk.classList.remove("hidden");
            prevBtn.classList.add("hidden");
            nextBtn.classList.add("hidden");

            scoreText.textContent = `Anda bisa melihat skor di profile`;

            // üîπ Simpan hasil akhir
            localStorage.setItem("quizResult", JSON.stringify({
                score: score,
                total: questions.length,
                answers: userAnswers
            }));

            // Hapus progress agar mulai ulang dari awal saat next buka
            localStorage.removeItem("quizProgress");
        }

        function restartQuiz() {
            currentQuestion = 0;
            userAnswers = [];
            resultDiv.classList.add("hidden");
            quizContainer.classList.remove("hidden");
            prevBtn.classList.remove("hidden");
            nextBtn.classList.remove("hidden");
            saveProgress();
            loadQuestion(currentQuestion);
        }

        nextBtn.addEventListener("click", () => {
            if (currentQuestion < questions.length - 1) {
                currentQuestion++;
                saveProgress();
                loadQuestion(currentQuestion);
            } else {
                finishQuiz();
            }
        });

        prevBtn.addEventListener("click", () => {
            if (currentQuestion > 0) {
                currentQuestion--;
                saveProgress();
                loadQuestion(currentQuestion);
            }
        });

        loadQuestion(currentQuestion);
    </script>

</body>

</html>