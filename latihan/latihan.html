<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kuis Identifikasi Gelombang</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
</head>

<body class="bg-slate-100 min-h-screen flex flex-col items-center">

    <!-- Tombol Kembali -->
    <div class="w-full max-w-md px-4 py-3">
        <button onclick="history.back();" class="bg-blue-500 text-white px-4 py-2 rounded-lg text-sm flex items-center">
            ‚Üê Kembali
        </button>
    </div>

    <!-- Header -->
    <div id="quiz-header" class="text-center my-4 px-4">
        <h1 class="text-xl font-bold text-blue-600">üìä Identifikasi Gelombang</h1>
    </div>

    <!-- Progress -->
    <div class="w-full max-w-md px-4 mt-4">
        <div class="flex justify-between text-sm text-gray-600 mb-1">
            <span id="progressText">Soal 1 / 1</span>
        </div>
        <div class="w-full bg-gray-200 rounded-full h-2">
            <div id="progressBar" class="bg-blue-500 h-2 rounded-full" style="width: 0%;"></div>
        </div>
    </div>

    <!-- Container -->
    <div class="w-full max-w-md bg-white rounded-2xl shadow-lg p-4 m-6">
        <div id="quiz-container"></div>

        <!-- Navigasi -->
        <div class="flex justify-between mt-6">
            <button id="prevBtn"
                class="bg-gray-300 text-gray-700 px-4 py-2 rounded-lg disabled:opacity-50">Back</button>
            <button id="nextBtn" class="bg-blue-500 text-white px-4 py-2 rounded-lg">Next</button>
        </div>

        <!-- Hasil -->
        <div id="result" class="hidden text-center mt-6">
            <h2 class="text-lg font-bold text-green-600">üéâ Hasil Latihan</h2>
            <p id="scoreText" class="text-gray-700 mt-2"></p>
            <button onclick="restartQuiz()" class="mt-4 bg-blue-500 text-white px-4 py-2 rounded-lg">
                Ulangi Kuis
            </button>
        </div>
    </div>

    <script src="soal_identifikasi.js"></script>
    <script>
        let currentQuestion = 0;
        let userAnswers = [];

        const quizContainer = document.getElementById("quiz-container");
        const prevBtn = document.getElementById("prevBtn");
        const nextBtn = document.getElementById("nextBtn");
        const progressText = document.getElementById("progressText");
        const progressBar = document.getElementById("progressBar");
        const resultDiv = document.getElementById("result");
        const scoreText = document.getElementById("scoreText");

        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }
        questions = shuffle(questions).slice(0, 10);

        // daftar pilihan jawaban statis
        const answerOptions = [
            "Takikardi Sinus (ST)",
            "Bradikardi Sinus (SB)",
            "Aritmia Sinus",
            "Sinus Arest",
            "Ekstrasistol Atrial",
            "Takikardi Supraventrikel (SVT)",
            "Flutter Atrial",
            "Fibrilasi Atrial (AF)",
            "Irama Junctional",
            "Ekstrasistol Junctional",
            "Takikardi Junctional",
            "Ekstrasistol Supraventrikel",
            "Takikardi Supraventrikel (Paroksismal)",
            "Irama Idioventrikuler",
            "Ekstrasistol Ventrikuler (VES)",
            "Takikardi Ventrikel (VT)",
            "Fibrilasi Ventrikel (VF)",
            "Blok Sinoatrial (SA Blok)",
            "Blok AV Derajat I",
            "Blok AV Derajat II Mobitz I (Wenckebach)",
            "Blok AV Derajat II Mobitz II",
            "Blok AV Derajat III (Total AV Blok)"
        ];

        function loadQuestion(index) {
            const q = questions[index];
            quizContainer.innerHTML = `
        ${q.image}
        <p class="text-lg font-semibold text-gray-800 mb-6">Identifikasi gelombang apakah ini?</p>

        <!-- Tombol Petunjuk -->
        <div class="mt-4" id="petunjukDiv">
          <span id="hintBtn" type="button" isOpen="false" onclick="openHintBox()" class="text-sm text-gray-400 cursor-pointer">
            Petunjuk <i class="fas fa-chevron-up"></i>
          </span>
          <div id="hintBox" class="hidden mt-2 p-3 bg-yellow-100 text-yellow-800 rounded-lg text-sm">
            ${q.hint}
          </div>
        </div>

        <!-- Pilihan jawaban -->
        <form onsubmit="submitAnswer(event, '${q.answer}')" class="flex flex-col gap-3 items-start w-full mt-4">
          <div class="grid grid-cols-2 gap-3 w-full">
            ${answerOptions.map(opt => `
              <label class="flex items-center gap-2 text-sm">
                <input type="radio" name="answer" value="${opt}" class="accent-blue-500">
                ${opt}
              </label>
            `).join("")}
          </div>
          <button type="submit"
            class="mt-4 px-5 py-2 rounded-xl font-medium text-white bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 shadow-md transition">
            Kirim Jawaban
          </button>
        </form>

        <!-- Feedback -->
        <div id="dynamic-content" class="mt-4"></div>
      `;

            // progress bar
            progressText.textContent = `Soal ${index + 1} / ${questions.length}`;
            progressBar.style.width = `${((index + 1) / questions.length) * 100}%`;

            prevBtn.disabled = index === 0;
            nextBtn.textContent = (index === questions.length - 1) ? "Selesai" : "Next";
        }

        function openHintBox() {
            let status = document.getElementById("hintBtn").getAttribute('isOpen');
            if (!status || status === "false") {
                document.getElementById("hintBtn").setAttribute('isOpen', 'true');
                document.getElementById("hintBox").classList.remove("hidden");
                document.getElementById("hintBtn").innerHTML = `Petunjuk <i class="fas fa-chevron-down"></i>`;
            } else {
                document.getElementById("hintBtn").setAttribute('isOpen', 'false');
                document.getElementById("hintBox").classList.add("hidden");
                document.getElementById("hintBtn").innerHTML = `Petunjuk <i class="fas fa-chevron-up"></i>`;
            }
        }

        function submitAnswer(e, correct) {
            e.preventDefault();
            const selected = document.querySelector("input[name='answer']:checked");
            const dynamic = document.getElementById("dynamic-content");
            if (!selected) return;

            if (selected.value.toLowerCase() === correct.toLowerCase()) {
                dynamic.innerHTML = `
          <div class="bg-green-50 border border-green-300 text-green-700 p-5 rounded-2xl shadow-inner animate-fadeIn">
            ‚úÖ Benar! Jawaban: <b>${correct}</b>
          </div>
        `;
                userAnswers[currentQuestion] = true;
            } else {
                dynamic.innerHTML = `
          <div class="bg-red-50 border border-red-300 text-red-700 p-5 rounded-2xl shadow-inner animate-fadeIn">
            ‚ùå Salah. Jawaban kamu: <b>${selected.value}</b><br>
            Jawaban benar: <b>${correct}</b>
          </div>
        `;
                userAnswers[currentQuestion] = false;
            }
        }

        function finishQuiz() {
            let score = userAnswers.filter(Boolean).length;

            // simpan ke localStorage
            localStorage.setItem("identifikasiResult", JSON.stringify({
                score: score,
                total: questions.length,
                date: new Date().toLocaleString("id-ID") // simpan juga waktu pengerjaan
            }));

            resultDiv.classList.remove("hidden");
            quizContainer.classList.add("hidden");
            prevBtn.classList.add("hidden");
            nextBtn.classList.add("hidden");

            scoreText.textContent = `Anda bisa melihat skor di halaman Nilai Kuis.`;
        }

        function restartQuiz() {
            currentQuestion = 0;
            userAnswers = [];
            resultDiv.classList.add("hidden");
            quizContainer.classList.remove("hidden");
            prevBtn.classList.remove("hidden");
            nextBtn.classList.remove("hidden");

            // hapus hasil lama supaya sesi baru mulai fresh
            localStorage.removeItem("identifikasiResult");

            loadQuestion(currentQuestion);
        }

        nextBtn.addEventListener("click", () => {
            if (currentQuestion < questions.length - 1) {
                currentQuestion++;
                loadQuestion(currentQuestion);
            } else {
                finishQuiz();
            }
        });

        prevBtn.addEventListener("click", () => {
            if (currentQuestion > 0) {
                currentQuestion--;
                loadQuestion(currentQuestion);
            }
        });

        loadQuestion(currentQuestion);
    </script>
</body>

</html>